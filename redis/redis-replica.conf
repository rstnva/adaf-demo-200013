# Redis Replica Configuration for ADAF Dashboard
# Slave instance for read operations and failover

# Network Configuration
bind 0.0.0.0
port 6379
protected-mode yes

# Replication Configuration
replicaof redis-primary 6379
masterauth ${REDIS_PASSWORD:-adaf_redis_secure_2024}
requirepass ${REDIS_PASSWORD:-adaf_redis_secure_2024}

# Replica Settings
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-ping-replica-period 10
repl-timeout 60
repl-disable-tcp-nodelay no
repl-backlog-size 1mb
repl-backlog-ttl 3600

# Memory Management (Smaller for replica)
maxmemory 256mb
maxmemory-policy allkeys-lru

# Persistence (Replica can be more aggressive with saves)
appendonly yes
appendfilename "adaf-redis-replica.aof"
appendfsync everysec

# RDB for backup
save 300 1
save 60 100
dbfilename "adaf-redis-replica.rdb"

# Logging
loglevel notice
logfile "/var/log/redis/redis-replica.log"

# Performance
timeout 300
tcp-keepalive 300
maxclients 500

# Security (Same restrictions as primary)
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command EVAL ""
rename-command DEBUG ""
rename-command CONFIG "CONFIG_a8f5d2e9c7b1"

# Monitoring
slowlog-log-slower-than 20000
slowlog-max-len 500